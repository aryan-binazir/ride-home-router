{{define "event_detail"}}
{{$useMiles := .UseMiles}}
{{if .Assignments}}
<div class="mt-3">
    <h4>Route Details</h4>

    {{$currentDriver := ""}}
    {{range .Assignments}}
        {{if ne .DriverName $currentDriver}}
            {{if ne $currentDriver ""}}
                </div></div>
            {{end}}
            <div class="route-card {{if .OrgVehicleName}}org-vehicle{{end}} mt-3">
                <div class="route-header">
                    <div class="driver-info">
                        <div class="driver-avatar" aria-hidden="true">{{initials .DriverName}}</div>
                        <div class="driver-meta">
                            <h4>
                                {{.DriverName}}
                                {{if .OrgVehicleName}}
                                <span class="badge badge-warning">{{.OrgVehicleName}}</span>
                                {{end}}
                            </h4>
                            <p>{{.DriverAddress}}</p>
                        </div>
                    </div>
                </div>
                <div class="route-stops">
            {{$currentDriver = .DriverName}}
        {{end}}

        <div class="stop-item">
            <div class="stop-number">{{add .RouteOrder 1}}</div>
            <div class="stop-details">
                <h4>{{.ParticipantName}}</h4>
                <p>{{.ParticipantAddress}}</p>
            </div>
            <div class="stop-distance">
                {{formatDistance .DistanceFromPrev $useMiles}}
            </div>
        </div>
    {{end}}
    {{if ne $currentDriver ""}}
        </div></div>
    {{end}}

    {{if .Summary}}
    <div class="route-summary mt-3">
        <h4>Event Summary</h4>
        <div class="summary-grid">
            <div class="summary-item">
                <div class="label">Participants</div>
                <div class="value">{{.Summary.TotalParticipants}}</div>
            </div>
            <div class="summary-item">
                <div class="label">Drivers</div>
                <div class="value">{{.Summary.TotalDrivers}}</div>
            </div>
            <div class="summary-item">
                <div class="label">Total Distance</div>
                <div class="value">{{formatDistance .Summary.TotalDistanceMeters $useMiles}}</div>
            </div>
            {{if gt .Summary.OrgVehiclesUsed 0}}
            <div class="summary-item">
                <div class="label">Org Vehicles</div>
                <div class="value">{{.Summary.OrgVehiclesUsed}}</div>
            </div>
            {{end}}
        </div>
    </div>
    {{end}}
</div>
{{end}}
{{end}}
