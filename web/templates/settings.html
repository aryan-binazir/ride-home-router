{{define "content"}}
<h2>Settings</h2>

<!-- Activity Locations Management -->
<div class="card">
    <h3>Activity Locations</h3>
    <p class="text-muted">Manage locations where activities take place (e.g., Soccer Practice, School).</p>

    <!-- Add New Location Form -->
    <form hx-post="/api/v1/activity-locations"
          hx-target="#location-list"
          hx-swap="beforeend"
          hx-on::after-request="this.reset()"
          class="mb-4">
        <div class="form-row">
            <div class="form-group" style="flex: 1;">
                <label class="form-label">Location Name</label>
                <input type="text"
                       name="name"
                       class="form-input"
                       placeholder="e.g., Soccer Practice"
                       required>
            </div>
            <div class="form-group" style="flex: 2;">
                <label class="form-label">Address</label>
                <input type="text"
                       name="address"
                       class="form-input"
                       placeholder="Full address"
                       required>
            </div>
            <div class="form-group" style="align-self: flex-end;">
                <button type="submit" class="btn btn-primary">Add Location</button>
            </div>
        </div>
    </form>

    <!-- Existing Locations List -->
    <div id="location-list">
        {{if .ActivityLocations}}
        {{range .ActivityLocations}}
        <div class="card" style="margin-bottom: 0.5rem; padding: 0.75rem;">
            <div class="d-flex justify-between align-center">
                <div>
                    <strong>{{.Name}}</strong>
                    <p class="text-muted" style="margin: 0.25rem 0 0 0; font-size: 0.875rem;">{{.Address}}</p>
                    <p class="text-muted" style="margin: 0; font-size: 0.75rem;">
                        Coordinates: {{printf "%.6f" .Lat}}, {{printf "%.6f" .Lng}}
                    </p>
                </div>
                <button hx-delete="/api/v1/activity-locations/{{.ID}}"
                        hx-confirm="Are you sure you want to delete this location?"
                        hx-target="closest .card"
                        hx-swap="outerHTML swap:1s"
                        class="btn btn-danger btn-sm">
                    Delete
                </button>
            </div>
        </div>
        {{end}}
        {{else}}
        <p class="text-muted">No activity locations yet. Add one above.</p>
        {{end}}
    </div>
</div>

<!-- Settings Form -->
<div class="card">
    <h3>Active Location &amp; Preferences</h3>
    <p class="text-muted">Select the activity location to use for route calculations.</p>

    <form hx-put="/api/v1/settings"
          hx-target="#settings-result"
          hx-indicator="#settings-loading">
        <div class="form-group">
            <label class="form-label">Selected Activity Location</label>
            <select name="selected_activity_location_id" class="form-input" required>
                <option value="">-- Select a location --</option>
                {{range .ActivityLocations}}
                <option value="{{.ID}}" {{if eq $.Settings.SelectedActivityLocationID .ID}}selected{{end}}>
                    {{.Name}} ({{.Address}})
                </option>
                {{end}}
            </select>
            {{if .SelectedLocation}}
            <div class="form-help">
                Current: {{.SelectedLocation.Name}} at {{printf "%.6f" .SelectedLocation.Lat}}, {{printf "%.6f" .SelectedLocation.Lng}}
            </div>
            {{end}}
        </div>

        <div class="form-group">
            <label class="form-label">Distance Units</label>
            <div class="d-flex align-center gap-2">
                <label class="checkbox-label">
                    <input type="checkbox"
                           name="use_miles"
                           class="form-checkbox"
                           {{if .Settings.UseMiles}}checked{{end}}>
                    <span>Use miles instead of kilometers</span>
                </label>
            </div>
        </div>

        <div class="d-flex align-center gap-2">
            <button type="submit" class="btn btn-primary">
                Save Settings
            </button>
            <span class="loading htmx-indicator" id="settings-loading"></span>
        </div>
    </form>

    <!-- Result Container -->
    <div id="settings-result" class="mt-3"></div>
</div>
{{end}}
